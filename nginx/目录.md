### nginx

### 声明变量

```shell
   # 声明变量名只能在server， location模块中使用
   set $变量名
```

### location

> 匹配优先级

```js
// 1：带有“=“的精确匹配优先
// 2：正则表达式按照他们在配置文件中定义的顺序
// 3：带有“^~”修饰符的，开头匹配
// 4：带有“~” 或“~*” 修饰符的，如果正则表达式与URI匹配
// 5：没有修饰符的，指定字符串与URI开头匹配
// 6: / 通用匹配

// 1 精准匹配
location =/ {
  return 401;
}
// 2.1 开始匹配 不能与2.2共存
location ^~ /images/{
  return 500;
}
// 2.2 指定字符串匹配 不能与2.1共存
location /images/{
  return 500;
}
// 3 正则匹配
location ~* .(html)$ {
  return 406;
}
//4 修饰符匹配
location ~ /images/ {
  return 405;
}
// 5 通用匹配，以上规则没有匹配则进行通用匹配
location / {
  return 402;
}

// ip/ 匹配1
// ip/images/ 匹配2.1 || 2.2(2.2规则优先级低于规则4)
// ip/xx/images/ 匹配4
// ip/xx/images/index.html 匹配3
// ip/xx/ 匹配5

// /images/与^~ /images/ 不能同时配置二者配置等价
// 注：大小写配置无效原因未知
```

```shell

# location中未指定index
# 1. url指定访问路径
# 2. url不指定路径 匹配满足要求的规则 默认查找（index index.html）

location / {
  root '';
};

#能够正常访问alias目录下的index.html
location /abc {
  alias /Users/yujie/development/lesson/lesson_js;
}
# 访问403
location /abc/ {
  alias /Users/yujie/development/lesson/lesson_js;
}
# 能够正常访问alias目录下的文件
location /abc {
  alias /Users/yujie/development/lesson/lesson_js/;
}
# 能够正常访问alias目录下的文件
location /abc/ {
  alias /Users/yujie/development/lesson/lesson_js/;
}
```

> `root:`指定访问路径时路径有无`/`都无影响  
> `alias:`
>
> > 携带`/`都会将`location`中匹配的部分丢弃， 不管`url`结尾是否存在 `/`  
> > 不携带`/`则`location`中的`url`结尾不能存在`/`否则会出现`403`或 `404`

### location 代理 proxy_pass

> 代理地址必须加上`http|https`

```shell
server {
  set $proxy_ip ip location;
  location / {
    proxy_pass $proxy_ip;
  };
}
```

> `proxy_pass` 代理 ip `/`携带问题
>
> > 携带`/` 丢弃 `location` 匹配的部分
> > 不携带`/` 不丢弃 `location` 匹配部分
